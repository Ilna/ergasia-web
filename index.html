<html>

<head>
  <title>Books DB API Frontend</title>
  <style>
    h1,
    h2 {
      color: #49274A;
    }

    h3 {
      color: #94618E;
    }


    body {

      background-color: #F4DECB;

    }

    .button {
      text-align: center;
      color: rgb(139, 83, 83);
      background-color: #F8EEE7;
      font-size: 16px;
      cursor: pointer;
    }

    .container {
      text-align: center;
    }

    table {

      font-family: arial, sans-serif;
      border-collapse: collapse;
      width: 100%;
      color: #94618E;

    }

    td,
    th {
      border: 1px solid #49274A;


    }

    tr:nth-child(even) {
      background-color: #dddddd;

    }
  </style>
</head>

<body>

  <div class="container">
    <h1 id="h1">Welcome to the Book DB handler!</h1>
    <input type="button" id="addBookel" value="Add Book" class="button" onclick="showAddForm()" />
    <br>
    <br>
    <form id="addBookForm" style="display: none">
      <div id="bookAdd">
        <h2>Add a new Book</h2>

        <h3>Type the author:</h3>
        <input type="text" name="author" id="author">
        <h3>Type the title:</h3>
        <input type="text" name="title" id="title">
        <h3>Select the genre:</h3>
        <select name="genre" id="genre">
          <option value="Science fiction">Science fiction</option>
          <option value="Satire">Satire</option>
          <option value="Drama">Drama</option>
          <option value="Action and Adventure">Action and Adventure</option>
          <option value="Romance">Romance</option>
          <option value="Mystery">Mystery</option>
          <option value="Horror">Horror</option>
        </select>
        <h3>Type the price:</h3>
        <input type="text" name="price" id="price">
        <br>
        <br>

        <input type="button" id="submitBook" value="Submit New Book" class="button" onclick="addBook()">

        <br>
        <br>
        <input type="button" id="bookBack" value="Back" class="button" onclick="backToMain()" >
        <br>
        <div id="bookAddResult"></div>
      </div>
    </form>

    <input type="button" id="findBookel" value="Find Book" class="button" onclick="showFindForm()" >
    <br>
    <br>
    <form id="findBookForm" style="display: none">
      <div id="bookByTitle">
        <h2>Find book by title</h2>
        <input type="text" id="findBook" />
        <input type="button" id="btn-findBook" value="Find Book" class="button" onclick="findBoook()" >
        <br>
        <br>
        <input type="button" id="bookBack" value="Back" class="button" onclick="backToMain()" >
        <br>
        <div id="showResults"></div>

      </div>
    </form>
    <input type="button" id="showBooks-btn1" value="Show All Books" class="button" onclick="showAllBooks1()" ><br><br>
    <form id="showBookForm" style="display: none">

      <input type="button" id="showBooks-btn" value="Show All Books" class="button" onclick="showAllBooks()">
      <input type="button" id="bookBack" value="Back" class="button" onclick="backToMain()" />
      <br>
      <h2>Table of books :</h2>
      <br>
      <div id="showBooks"></div>
      <br>
    </form>
    <input type="button" id="btn-deleteBook" value="Delete Book" class="button" onclick="showdeleteBoookForm()" />
    <form id="deleteBookForm" style="display: none">
        <div id="deleteByTitle">
          <h2>Delete book by title</h2>
          <input type="text" id="deleteBook" />
          <input type="button" id="btn-deleteBook" value="Delete Book" class="button" onclick="deleteBoook()" />
          <br>
          <br>
          <input type="button" id="bookBack" value="Back" class="button" onclick="backToMain()" />
          <br>
          <div id="showResults"></div>
  
        </div>
      </form>
  </div>

  <script>


    function deleteBoook() {
      document.getElementById("btn-delteBook").addEventListener('click', function () {
        var userInput = document.getElementById('deleteBook').value;
        console.log(userInput);
        let xhttp = new XMLHttpRequest();
        let url = "http://localhost:3000/books/" + userInput;
        xhttp.open("GET", url, true);
        xhttp.onreadystatechange = function () {
          if (this.readyState == 4 && this.status == 200) {
            let results = JSON.parse(xhttp.responseText);
            let divEl = document.getElementById('bookByTitle');
            for (result of results) {
              console.log(result);
              divEl.innerHTML += '<ul><li>' + result.title + '</li><li>' + result.author + '</li><li>' + result.genre + '</li><li>' + result.price + '</li></ul>';
            }
          }
        };
        xhttp.send();
      })
    }
    function showAllBooks() {
      document.getElementById("showBooks-btn").addEventListener('click', function () {


        let xhttp = new XMLHttpRequest();
        let url = window.location + "books";
        xhttp.open("GET", url, true);
        xhttp.onreadystatechange = function () {
          if (this.readyState == 4 && this.status == 200) {
            let results = JSON.parse(xhttp.responseText);
            let divEl = document.getElementById('showBooks');
            let count = 0;
            //let table = "<table ><tr><th  bgcolor='white'>Author</th><th bgcolor='white'>Title</th><th bgcolor='white'>Genre</th><th bgcolor='white'>Price</th></tr>";
            for (result of results) {
              count++;
              console.log(result);
              divEl.innerHTML += '<h3>book : '+count+'</h3><ul><li>Titlie : ' + result.title + '</li><li>Author : ' + result.author + '</li><li>Genre : ' + result.genre + '</li><li>Price : ' + result.price + '</li></ul>';
              //table += '<table><tr><th>' + result.author + '</th><th>' + result.title + '</th><th>' + result.genre + '</th><th>' + result.price + '</th></tr>';
            }
            table += "</table>";
            //divEl.innerHTML = table;
          }
        };
        xhttp.send();
      })
    }

    function findBoook() {
      document.getElementById("btn-findBook").addEventListener('click', function () {
        var userInput = document.getElementById('findBook').value;
        console.log(userInput);
        let xhttp = new XMLHttpRequest();
        let url = "http://localhost:3000/books/" + userInput;
        xhttp.open("GET", url, true);
        xhttp.onreadystatechange = function () {
          if (this.readyState == 4 && this.status == 200) {
            let results = JSON.parse(xhttp.responseText);
            let divEl = document.getElementById('bookByTitle');
            if(results.length == 0){
              divEl.innerHTML ='<h3><b><em>No book with title "'+ userInput+'" exists!</h3></b></em>';
            }else{
            
            for (result of results) {
              console.log(result);
              divEl.innerHTML += '<ul><li>Title : ' + result.title + '</li><li>Author : ' + result.author + '</li><li>Genre : ' + result.genre + '</li><li>Price : ' + result.price + '</li></ul>';
            }
          }
        }
        };
        xhttp.send();
      })
    }

    function addBook() {

      var author = document.getElementById('author').value;
      var title = document.getElementById('title').value;
      var genre = document.getElementById('genre').value;
      var price = document.getElementById('price').value;
      var response;
      console.log(author, title, genre, price);
      var url = window.location + "books/" + author + "/" + title + "/" + genre + "/" + price;

      if (author == '' || title == '' || price == '') {
        alert("You must fill in the form.");
        return;
      }
      if (isNaN((price))) {
        alert("price must be of numeric value.");
        return;
      }
      if (author.length > 25 || title.length > 40 || author == title) {
        alert("Either the author's or the title's size is bigger than it should be, or the author and title inputs are the same");

        return;
      }

      var book = { 'author': author, 'title': title, 'genre': genre, 'price': price };
      let newBook = JSON.stringify(book);


      var xmlhttp = new XMLHttpRequest();
      xmlhttp.open("POST", url, true);
      xmlhttp.send(newBook);


      xmlhttp.onreadystatechange = function () {
        if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
          response = JSON.parse(this.responseText);
          document.getElementById("bookAddResult").innerHTML = '<h3><b><em>The New Book has Submited Succesfully</h3></b></em>';

        }
      };
      resetAdd();

    }
    function showAddForm() {
      document.getElementById('addBookel').style.display = "none";
      document.getElementById('addBookForm').style.display = "block";
      document.getElementById('findBookel').style.display = "none";
      document.getElementById('h1').style.display = "none";
      document.getElementById('showBooks-btn1').style.display = "none";
    }
    function showFindForm() {
      document.getElementById('addBookel').style.display = "none";
      document.getElementById('findBookel').style.display = "none";
      document.getElementById('findBookForm').style.display = "block";
      document.getElementById('h1').style.display = "none";
      document.getElementById('showBooks-btn1').style.display = "none";
    }

    function backToMain() {
      document.getElementById('addBookel').style.display = "block";
      document.getElementById('findBookel').style.display = "block";
      document.getElementById('findBookel').style.textAlign = "center";
      document.getElementById('findBookForm').style.display = "none";
      document.getElementById('addBookForm').style.display = "none";
      document.getElementById('bookAddResult').style.display = "none";
      document.getElementById('h1').style.display = "block";
      document.getElementById('showBooks-btn').style.display = "none";
      document.getElementById('showBooks-btn1').style.display = "block";
      document.getElementById('showBookForm').style.display = "none";
    }

    function resetAdd() {
      document.getElementById('author').value = '';
      document.getElementById('title').value = '';
      document.getElementById('genre').value = '';
      document.getElementById('price').value = '';
    }
    function resetFind() {
      document.getElementById('findBook').value = '';
      document.getElementById('bookByTitle').value = '';

    }


    function showAllBooks1() {
      document.getElementById('showBookForm').style.display = "block";
      document.getElementById('addBookel').style.display = "none";
      document.getElementById('findBookel').style.display = "none";
      document.getElementById('showBooks-btn1').style.display = "none";
      document.getElementById('showBooks-btn').style.display = "center";
      document.getElementById('h1').style.display = "none";


    }

    function showdeleteBoookForm(){
      document.getElementById('deleteBoookForm').style.display = "block";
      document.getElementById('addBookel').style.display = "none";
      document.getElementById('findBookel').style.display = "none";
      document.getElementById('showBooks-btn1').style.display = "none";
      document.getElementById('h1').style.display = "none";

    }
  </script>
</body>









</html>